fullname: DevAssistant package
description: Set up environment for DevAssistant package development

dependencies:
- rpm: ['devassistant']

args:
  name:
    use: common_args

  github:
    use: common_args

  crt:
    flags:
    - --crt
    action: store_const
    const: crt
    default: ''
    help:
      'Create empty crt assistant'

  mod:
    flags:
    - --mod
    action: store_const
    const: mod
    default: ''
    help:
      'Create empty mod assistant'

  prep:
    flags:
    - --prep
    action: store_const
    const: prep
    default: ''
    help:
      'Create empty prep assistant'

  task:
    flags:
    - --task
    action: store_const
    const: task
    default: ''
    help:
      'Create empty task assistant'

  snippet:
    flags:
    - --snippet
    action: store_const
    const: snippet
    default: ''
    help:
      'Create empty snippet'

run:
- setup_project_dir:
    from: $name
    on_existing: fail
    create_topdir: True
    contdir_var: dirname
    topdir_normalized_var: basename
- log_i: 'Creating dap directory structure'
- cl: cd "$basename"
- cl: mkdir -p "assistants"
- if not ($crt or $mod or $prep or $task):
  - cl: touch "assistants/.gitkeep"
  - if not $snippet:
    - log_w: 'You have not specified any of the following options: --crt, --mod, --prep, --task, --snippet. To add assistant or snippet later, use "da mod dap" assistant.'
- cl: mkdir -p "docs/$basename"
- cl: touch "docs/$basename/LICENSE"
- cl: mkdir -p "files/$basename"
- cl: touch "files/$basename/.gitkeep"
- cl: mkdir -p "icons/$basename"
- cl: touch "icons/$basename/.gitkeep"
- cl: echo '*.dap' > .gitignore
- if $crt:
  - log_i: 'Creating empty crt assistant in assistants/crt/$basename.yaml'
  - cl: mkdir assistants/crt
  - cl: 'echo "fullname: $basename" > "assistants/crt/$basename.yaml"'
- if $mod:
  - log_i: 'Creating empty mod assistant in assistants/mod/$basename.yaml'
  - cl: mkdir assistants/mod
  - cl: 'echo "fullname: $basename" > "assistants/mod/$basename.yaml"'
- if $prep:
  - log_i: 'Creating empty prep assistant in assistants/prep/$basename.yaml'
  - cl: mkdir assistants/prep
  - cl: 'echo "fullname: $basename" > "assistants/prep/$basename.yaml"'
- if $task:
  - log_i: 'Creating empty task assistant in assistants/task/$basename.yaml'
  - cl: mkdir assistants/task
  - cl: 'echo "fullname: $basename" > "assistants/task/$basename.yaml"'
- if $snippet:
  - log_i: 'Creating empty snippet in snippets/$basename.yaml'
  - cl: mkdir snippets
  - cl: 'echo "fullname: $basename" > "snippets/$basename.yaml"'
- use: git_init_add_commit.run
- if defined $github:
  - github: create_and_push
